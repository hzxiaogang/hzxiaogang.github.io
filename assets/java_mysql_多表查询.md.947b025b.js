import{_ as s,o as a,c as n,V as l}from"./chunks/framework.364d6ed5.js";const e="/dikaerji.png",m=JSON.parse('{"title":"多表查询","description":"","frontmatter":{"title":"多表查询","date":"2022-09-25T22:28:58.000Z","permalink":"/pages/dff523/","categories":["java","mysql"],"tags":[null]},"headers":[],"relativePath":"java/mysql/多表查询.md","filePath":"java/mysql/多表查询.md","lastUpdated":1685806707000}'),p={name:"java/mysql/多表查询.md"},o=l('<h1 id="多表查询" tabindex="-1">多表查询 <a class="header-anchor" href="#多表查询" aria-label="Permalink to &quot;多表查询&quot;">​</a></h1><p>多表查询是指基于两个和两个以上的表查询，在实际应用中，查询单个表可能不满足我们的需求。</p><h2 id="_1-多表笛卡尔集" tabindex="-1">1. 多表笛卡尔集 <a class="header-anchor" href="#_1-多表笛卡尔集" aria-label="Permalink to &quot;1. 多表笛卡尔集&quot;">​</a></h2><h4 id="_1-1-笛卡尔积" tabindex="-1">1.1 笛卡尔积 <a class="header-anchor" href="#_1-1-笛卡尔积" aria-label="Permalink to &quot;1.1 笛卡尔积&quot;">​</a></h4><img src="'+e+`"><p>在默认情况下，当两个表查询时，规则如下：</p><ul><li><ol><li>从第一张表，取出一行和第二张表的每一行进行组合，返回结果(含有两张表的所有列)</li></ol></li><li><ol start="2"><li>一共返回的记录数： 第一张表行数 * 第二张表的行数</li></ol></li><li><ol start="3"><li>这样多表查询默认处理返回的结果，称为笛卡尔积（大于<code>2</code>张的表查询也适用）</li></ol></li></ul><p>解决多表查询的关键就是要写出正确的过滤条件（where）</p><p>注意 ：<strong>多表查询的条件不能少于表的个数减一，否则会出现笛卡尔积</strong></p><h4 id="_1-2-案例" tabindex="-1">1.2 案例 <a class="header-anchor" href="#_1-2-案例" aria-label="Permalink to &quot;1.2 案例&quot;">​</a></h4><p>显示员工名字,工资以及所在部门</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> emp.name,salary,dept.name</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp,dept</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">where</span></span>
<span class="line"><span style="color:#A6ACCD;">  emp.dept_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> dept.id</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_2-自连接" tabindex="-1">2. 自连接 <a class="header-anchor" href="#_2-自连接" aria-label="Permalink to &quot;2. 自连接&quot;">​</a></h2><h4 id="_2-1-概念" tabindex="-1">2.1 概念 <a class="header-anchor" href="#_2-1-概念" aria-label="Permalink to &quot;2.1 概念&quot;">​</a></h4><p>自连接是指在同一张表的连接查询（将同一张表看作两张表使用），有以下特点：</p><ul><li><ol><li>把同一张表看作两张表使用</li></ol></li><li><ol start="2"><li>需要给表取别名</li></ol></li><li><ol start="3"><li>列名不明确，可以指定列的别名</li></ol></li></ul><h4 id="_2-2-案例" tabindex="-1">2.2 案例 <a class="header-anchor" href="#_2-2-案例" aria-label="Permalink to &quot;2.2 案例&quot;">​</a></h4><p>显示员工的名字和他的上级的名字</p><ul><li><ol><li>员工的名字在<code>emp</code>表，上级的名字也在 <code>emp</code>表</li></ol></li><li><ol start="2"><li>员工和上级是通过<code>emp</code>表的<code>mgr</code>列关联</li></ol></li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> worker.ename </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">职员名</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> , boss.ename </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">上级名</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> worker,emp </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;">  boss</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> worker.mgr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> boss.empno;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_3-子查询" tabindex="-1">3. 子查询 <a class="header-anchor" href="#_3-子查询" aria-label="Permalink to &quot;3. 子查询&quot;">​</a></h2><p>子查询指<strong>将一个查询语句嵌套在另一个查询语句中</strong>。子查询可以在 <code>SELECT</code>、<code>UPDATE</code> 和 <code>DELETE</code> 语句中使用，而且可以进行<strong>多层嵌套</strong>。在实际开发时，子查询经常出现在 <code>WHERE</code> 子句中。</p><h2 id="_4-单行子查询" tabindex="-1">4. 单行子查询 <a class="header-anchor" href="#_4-单行子查询" aria-label="Permalink to &quot;4. 单行子查询&quot;">​</a></h2><p>单行子查询是指<strong>只返回一行数据</strong>的<strong>子查询语句</strong></p><h4 id="_1-案例" tabindex="-1">1. 案例 <a class="header-anchor" href="#_1-案例" aria-label="Permalink to &quot;1. 案例&quot;">​</a></h4><p>显示与<code>SMITH</code>同一个部门的所有员工</p><ul><li><ol><li>先查询到<code>SMITH</code>的部门号</li></ol></li></ul><p><code>SELECT deptnp from emp WHERE ename = &#39;SMITH&#39;</code></p><ul><li><ol start="2"><li>把上面的<code>select</code>语句当作一个子查询使用</li></ol></li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> deptno </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> deptnp</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> ename </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SMITH</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_5-多行子查询" tabindex="-1">5. 多行子查询 <a class="header-anchor" href="#_5-多行子查询" aria-label="Permalink to &quot;5. 多行子查询&quot;">​</a></h2><p>多行子查询是指<strong>返回多行数据</strong>的<strong>子查询语句</strong>，</p><h3 id="_5-1-使用关键字in" tabindex="-1">5.1 使用关键字<code>in</code> <a class="header-anchor" href="#_5-1-使用关键字in" aria-label="Permalink to &quot;5.1 使用关键字\`in\`&quot;">​</a></h3><p>如何查询和部门<code>10</code>的工作相同的雇员的名字，岗位，工资，部门号，但是不含<code>10</code>自己的雇员</p><ul><li><ol><li>先查到<code>10</code>号部门有那些工作</li></ol></li></ul><p><code>SELECT DISTINCT job from emp WHERE deptno= 10</code></p><ul><li><ol start="2"><li>把上面语句当作子查询</li></ol></li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ename,job,sal,deptno</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> job </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT DISTINCT</span><span style="color:#A6ACCD;"> job</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> deptno </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span></span>
<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> deptno </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_5-2-使用关键字all" tabindex="-1">5.2 使用关键字<code>all</code> <a class="header-anchor" href="#_5-2-使用关键字all" aria-label="Permalink to &quot;5.2 使用关键字\`all\`&quot;">​</a></h3><h4 id="_1-案例-1" tabindex="-1">1. 案例 <a class="header-anchor" href="#_1-案例-1" aria-label="Permalink to &quot;1. 案例&quot;">​</a></h4><p>显示工资比部门<code>30</code>的所有员工的工资高的员工的姓名，工资和部门号</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ename,sal,deptno</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> sal </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> ALL(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> sal</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> deptno </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>或者:</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ename,sal,deptno</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> sal </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">max</span><span style="color:#A6ACCD;">(sal)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> deptno </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_5-使用关键字any" tabindex="-1">5. 使用关键字<code>any</code> <a class="header-anchor" href="#_5-使用关键字any" aria-label="Permalink to &quot;5. 使用关键字\`any\`&quot;">​</a></h3><h4 id="_1-案例-2" tabindex="-1">1. 案例 <a class="header-anchor" href="#_1-案例-2" aria-label="Permalink to &quot;1. 案例&quot;">​</a></h4><p>显示员工工资比部门<code>30</code>的其中一个员工的工资高的员工的姓名，工资和部门号</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ename,sal,deptno</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> sal </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> ANY(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> sal</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> deptno </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">30</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_6-多列子查询" tabindex="-1">6. 多列子查询 <a class="header-anchor" href="#_6-多列子查询" aria-label="Permalink to &quot;6. 多列子查询&quot;">​</a></h2><p>多列子查询是指查询<strong>返回多个列数据</strong>的<strong>子查询语句</strong></p><h4 id="_1-语法" tabindex="-1">1. 语法 <a class="header-anchor" href="#_1-语法" aria-label="Permalink to &quot;1. 语法&quot;">​</a></h4><p><code>(字段1，字段2...) = (select 字段1，字段2 from ...)</code></p><h4 id="_2-案例" tabindex="-1">2. 案例 <a class="header-anchor" href="#_2-案例" aria-label="Permalink to &quot;2. 案例&quot;">​</a></h4><p>查询与<code>SMITH</code>的部门和岗位完全相同的所有雇员，并且不含<code>SMITH</code>本人</p><ul><li><ol><li>得到<code>SMITH</code>的部门和岗位</li></ol></li></ul><p><code>SELECT deptno,job FROM emp WHERE ename = &#39;SMITH&#39;</code></p><ul><li><ol start="2"><li>把上面的查询当作子查询来使用，并且使用多列子查询的语法进行匹配</li></ol></li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> (deptno,job) </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> deptno,job</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> emp</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> ename </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SMITH</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> ename </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SMITH</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_7-子查询临时表" tabindex="-1">7. 子查询临时表 <a class="header-anchor" href="#_7-子查询临时表" aria-label="Permalink to &quot;7. 子查询临时表&quot;">​</a></h2><p>即子查询当作临时表使用</p><h4 id="_1-案例-3" tabindex="-1">1. 案例 <a class="header-anchor" href="#_1-案例-3" aria-label="Permalink to &quot;1. 案例&quot;">​</a></h4><p>查询<code>ecshop</code>表中各个类别中，价格最高的商品</p><ul><li><ol><li>查询商品表</li></ol></li></ul><p><code>SELECT goods_id, cat_id,goods_name,shop_price from ecs_goods</code></p><ul><li><ol start="2"><li>先得到各个类别中，价格最高的商品（max + group by cat_id）,当作临时表</li></ol></li></ul><p><code>SELECT cat_id , MAX(shop_price) as max_price from ecs_goods GROUP BY cat_id</code></p><ul><li><ol start="3"><li>完整代码</li></ol></li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> goods_id, ecs_goods.cat_id,goods_name,shop_price</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> cat_id , </span><span style="color:#82AAFF;">MAX</span><span style="color:#A6ACCD;">(shop_price) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> max_price</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> ecs_goods</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> cat_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  ) </span><span style="color:#F78C6C;">as</span><span style="color:#A6ACCD;"> temp , ecs_goods</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> temp.cat_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ecs_goods.cat_id</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> temp.max_price </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ecs_goods.shop_price;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_8-表复制" tabindex="-1">8. 表复制 <a class="header-anchor" href="#_8-表复制" aria-label="Permalink to &quot;8. 表复制&quot;">​</a></h2><p>自我复制数据（蠕虫复制）。</p><p>有时，为了对某个<code>sql</code>语句进行效率测试，我们需要海量数据时，可以使用此法为表创建海量数据</p><h4 id="_1-准备工作" tabindex="-1">1. 准备工作 <a class="header-anchor" href="#_1-准备工作" aria-label="Permalink to &quot;1. 准备工作&quot;">​</a></h4><p>创建表<code>my_tab01</code></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">my_tab01</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;"> id </span><span style="color:#C792EA;">INT</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">VARCHAR</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">32</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;"> sal DOUBLE,</span></span>
<span class="line"><span style="color:#A6ACCD;"> job </span><span style="color:#C792EA;">VARCHAR</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">32</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;"> deptno </span><span style="color:#C792EA;">INT</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_2-把emp表的记录复制到my-tab01" tabindex="-1">2. 把<code>emp</code>表的记录复制到<code>my_tab01</code> <a class="header-anchor" href="#_2-把emp表的记录复制到my-tab01" aria-label="Permalink to &quot;2. 把\`emp\`表的记录复制到\`my_tab01\`&quot;">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#A6ACCD;"> my_tab01</span></span>
<span class="line"><span style="color:#A6ACCD;">  (id,</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">,sal,job,deptno)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> empno, ename,sal,job,deptno</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-自我复制" tabindex="-1">3. 自我复制 <a class="header-anchor" href="#_3-自我复制" aria-label="Permalink to &quot;3. 自我复制&quot;">​</a></h4><p><code>INSERT INTO my_tab01 SELECT * FROM my_tab01;</code></p><h4 id="_4-案例-去重my-tab01的记录" tabindex="-1">4. 案例： 去重<code>my_tab01</code>的记录 <a class="header-anchor" href="#_4-案例-去重my-tab01的记录" aria-label="Permalink to &quot;4. 案例： 去重\`my_tab01\`的记录&quot;">​</a></h4><p>思路：</p><ul><li><ol><li>先创建一张临时表<code>my_temp</code>，该表的结构和<code>my_tab01</code>表一样</li></ol></li></ul><p><code>CREATE TABLE my_temp LIKE my_tab01</code></p><ul><li><ol start="2"><li>把 <code>my_tab01</code>表的记录通过<code>distinct</code>关键字，处理后，把记录复制到 表<code>my_temp</code></li></ol></li></ul><p><code>INSERT INTO my_temp SELECT distinct * FROM my_tab01;</code></p><ul><li><ol start="3"><li>清除掉<code>my_tab01</code>表的记录</li></ol></li></ul><p><code>DELETE FROM my_tab01</code></p><ul><li><ol start="4"><li>把<code>my_temp</code>表的记录复制到<code>my_tab01</code>表</li></ol></li></ul><p><code>INSERT INTO my_tab01 SELECT * FROM my_temp;</code></p><ul><li><ol start="5"><li>删除掉临时表<code>my_temp</code></li></ol></li></ul><p><code>DROP TABLE my_temp</code></p><h2 id="_9-合并查询-union-all" tabindex="-1">9. 合并查询 union [all] <a class="header-anchor" href="#_9-合并查询-union-all" aria-label="Permalink to &quot;9. 合并查询 union [all]&quot;">​</a></h2><p><code>NION</code> 操作符用于连接两个以上的 <code>SELECT</code> 语句的<strong>结果组合到一个结果集合中</strong>(并集)</p><h4 id="_1-语法-1" tabindex="-1">1. 语法 <a class="header-anchor" href="#_1-语法-1" aria-label="Permalink to &quot;1. 语法&quot;">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> expression1, expression2, ... expression_n</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> tables</span></span>
<span class="line"><span style="color:#A6ACCD;">[WHERE conditions]</span></span>
<span class="line"><span style="color:#F78C6C;">UNION</span><span style="color:#A6ACCD;"> [ALL | DISTINCT]</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> expression1, expression2, ... expression_n</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> tables</span></span>
<span class="line"><span style="color:#A6ACCD;">[WHERE conditions];</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><ol><li><code>expression1</code>, <code>expression2</code>, ... <code>expression_n</code>: 要检索的列。</li></ol></li><li><p>2.<code>tables</code>: 要检索的数据表。</p></li><li><ol start="3"><li><code>WHERE conditions</code>: 可选， 检索条件。</li></ol></li><li><ol start="4"><li><code>DISTINCT</code>: 可选，删除结果集中重复的数据。默认情况下 UNION 操作符已经删除了重复数据，所以 <code>DISTINCT</code> 修饰符对结果没啥影响。</li></ol></li><li><ol start="5"><li><code>ALL</code>: 可选，返回所有结果集，包含重复数据。</li></ol></li></ul><h4 id="_2-案例-1" tabindex="-1">2. 案例 <a class="header-anchor" href="#_2-案例-1" aria-label="Permalink to &quot;2. 案例&quot;">​</a></h4><p><code>union</code>，就是将两个查询结构合并，<strong>会去重</strong></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ename,sal,job </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> sal </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2500</span></span>
<span class="line"><span style="color:#F78C6C;">UNION</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ename,sal,job </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> job</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MANAGER</span><span style="color:#89DDFF;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>union all</code>，就是将两个查询结构合并，<strong>不会去重</strong></p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ename,sal,job </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> sal </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2500</span></span>
<span class="line"><span style="color:#F78C6C;">UNION ALL</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ename,sal,job </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> emp </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> job</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MANAGER</span><span style="color:#89DDFF;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>`,100),r=[o];function c(t,i,C,d,y,A){return a(),n("div",null,r)}const u=s(p,[["render",c]]);export{m as __pageData,u as default};
